From b8d8e3e586208b47c94e9e0bbb1aac8825309438 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=C3=89bano=20Lopes?= <ebano@onbi.com.br>
Date: Wed, 8 May 2024 17:26:50 +0000
Subject: [PATCH] MAG-914: Magento 2.4.7 - Fix parent constructor call in
 Abandoned Grid

---
 Block/Adminhtml/Shopcart/Abandoned/Grid.php | 37 ++++++++++++++++++++-
 1 file changed, 36 insertions(+), 1 deletion(-)

diff --git a/vendor/signifyd/module-connect/Block/Adminhtml/Shopcart/Abandoned/Grid.php b/vendor/signifyd/module-connect/Block/Adminhtml/Shopcart/Abandoned/Grid.php
index 993b62b..7479fd2 100644
--- a/vendor/signifyd/module-connect/Block/Adminhtml/Shopcart/Abandoned/Grid.php
+++ b/vendor/signifyd/module-connect/Block/Adminhtml/Shopcart/Abandoned/Grid.php
@@ -2,7 +2,10 @@
 
 namespace Signifyd\Connect\Block\Adminhtml\Shopcart\Abandoned;
 
+use Magento\Framework\App\ProductMetadataInterface;
 use Magento\Framework\Serialize\Serializer\Json as JsonSerializer;
+use Magento\Framework\Stdlib\Parameters;
+use Magento\Framework\Url\DecoderInterface;
 use Magento\Store\Model\ScopeInterface;
 use Signifyd\Connect\Helper\ConfigHelper;
 
@@ -20,24 +23,56 @@ class Grid extends \Magento\Reports\Block\Adminhtml\Shopcart\Abandoned\Grid
 
     /**
      * Grid constructor.
+     *
+     * @param ProductMetadataInterface $productMetadataInterface
      * @param \Magento\Backend\Block\Template\Context $context
      * @param \Magento\Backend\Helper\Data $backendHelper
      * @param \Magento\Reports\Model\ResourceModel\Quote\CollectionFactory $quotesFactory
      * @param JsonSerializer $jsonSerializer
      * @param ConfigHelper $configHelper
+     * @param DecoderInterface|null $urlDecoder
+     * @param Parameters|null $parameters
      * @param array $data
      */
     public function __construct(
+        ProductMetadataInterface $productMetadataInterface,
         \Magento\Backend\Block\Template\Context $context,
         \Magento\Backend\Helper\Data $backendHelper,
         \Magento\Reports\Model\ResourceModel\Quote\CollectionFactory $quotesFactory,
         JsonSerializer $jsonSerializer,
         ConfigHelper $configHelper,
+        DecoderInterface $urlDecoder = null,
+        Parameters $parameters = null,
         array $data = []
     ) {
+        //Backward compatibility with Magento 2.4.6 or less, in this version the parent
+        // construct don't have $urlDecoder and $parameters parameters, causing di:compile error
+        $this->initConstructor(
+            $productMetadataInterface, $context, $backendHelper, $quotesFactory, $urlDecoder, $parameters, $data
+        );
+
         $this->jsonSerializer = $jsonSerializer;
         $this->configHelper = $configHelper;
-        parent::__construct($context, $backendHelper, $quotesFactory, $data);
+    }
+
+    /**
+     * @param $productMetadataInterface
+     * @param $context
+     * @param $backendHelper
+     * @param $quotesFactory
+     * @param $urlDecoder
+     * @param $parameters
+     * @param $data
+     * @return void
+     */
+    public function initConstructor(
+        $productMetadataInterface, $context, $backendHelper, $quotesFactory, $urlDecoder, $parameters, $data
+    ) {
+        if (version_compare($productMetadataInterface->getVersion(), '2.4.7') >= 0) {
+            parent::__construct($context, $backendHelper, $quotesFactory, $urlDecoder, $parameters, $data);
+        } else {
+            parent::__construct($context, $backendHelper, $quotesFactory, $data);
+        }
     }
 
     /**
-- 
2.17.1

